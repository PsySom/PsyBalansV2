# PsyBalans API

API для психологической платформы PsyBalans — системы для осознанного планирования, саморегуляции и восстановления психологического благополучия.

## Установка и запуск

### Подготовка окружения

1. Клонируйте репозиторий
   ```bash
   git clone https://github.com/yourusername/PsyBalansV2.git
   cd PsyBalansV2
   ```

2. Создайте виртуальное окружение Python:
   ```bash
   # Windows
   python -m venv venv
   
   # Linux/MacOS
   python3 -m venv venv
   ```

3. Активируйте виртуальное окружение:
   ```bash
   # Windows
   .\venv\Scripts\activate
   
   # Linux/MacOS
   source venv/bin/activate
   ```

4. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

### Настройка переменных окружения

1. Создайте файл `.env` в корневой директории проекта (или отредактируйте существующий):
   ```
   # Настройки приложения
   APP_NAME=PsyBalans API
   APP_VERSION=0.1.0
   APP_DESCRIPTION="API для психологической платформы PsyBalans"
   DEBUG=true

   # PostgreSQL настройки
   # Для использования SQLite закомментируйте или удалите эту строку
   # DATABASE_URL=postgresql+asyncpg://username:password@hostname:5432/dbname
   
   # MongoDB настройки
   MONGODB_URL=mongodb://localhost:27017
   MONGODB_DB_NAME=psybalans
   # Для подключения к MongoDB Atlas
   # MONGODB_URL=mongodb+srv://username:password@cluster.mongodb.net/?retryWrites=true&w=majority
   
   # Redis настройки (оставить пустым для in-memory режима)
   REDIS_HOST=localhost
   REDIS_PORT=6379
   REDIS_DB=0
   REDIS_PASSWORD=
   
   # Настройки безопасности
   SECRET_KEY=your-secret-key-here
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=30
   REFRESH_TOKEN_EXPIRE_DAYS=7
   
   # Настройки логирования
   LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR
   LOG_FORMAT=json  # json или text
   # LOG_FILE=logs/app.log  # раскомментируйте для записи логов в файл
   ```

### Запуск приложения

#### Вариант 1: Использование скрипта (Windows)
```
run.bat
```

#### Вариант 2: Запуск вручную
```bash
# Активируйте виртуальное окружение, если еще не активировано
# Windows
.\venv\Scripts\activate
# Linux/MacOS
source venv/bin/activate

# Запуск сервера разработки
uvicorn app.main:app --reload
```

4. Откройте API документацию по адресу http://127.0.0.1:8000/docs

### Тестирование изменений модели пользователя

Вы можете протестировать новую модель пользователя и административные эндпоинты следующим образом:

1. **Регистрация пользователя-администратора** (через API):
   ```
   POST /api/user/register
   {
     "email": "admin@example.com",
     "password": "securepassword",
     "first_name": "Admin",
     "last_name": "User"
   }
   ```

2. **Создание суперпользователя** (через SQLite CLI):
   
   Если вы используете SQLite для разработки, вы можете создать суперпользователя вручную:
   ```bash
   # Откройте SQLite CLI
   sqlite3 psybalans.db
   
   # Обновите пользователя, сделав его супер-администратором
   UPDATE users SET is_superuser = 1 WHERE email = 'admin@example.com';
   
   # Выйдите из SQLite CLI
   .exit
   ```

3. **Тестирование административных эндпоинтов**:
   
   a. Сначала получите токен, выполнив вход:
   ```
   POST /api/auth/login
   {
     "username": "admin@example.com",
     "password": "securepassword"
   }
   ```
   
   b. Используйте полученный `access_token` для вызова административных эндпоинтов:
   ```
   GET /api/user/admin/users
   ```
   
   c. Создайте обычного пользователя через стандартную регистрацию, а затем протестируйте активацию/деактивацию:
   ```
   PUT /api/user/admin/users/{user_id}/deactivate
   PUT /api/user/admin/users/{user_id}/activate
   ```

### Проверка работы с UUID

Чтобы убедиться, что UUID работает корректно:

1. Зарегистрируйте нового пользователя
2. Получите данные пользователя через `GET /api/user/me`
3. Проверьте, что поле `id` содержит корректный UUID, например: `123e4567-e89b-12d3-a456-426614174000`

### Запуск тестов (TBD)

В следующих версиях будут добавлены автоматические тесты. Тесты можно будет запустить следующим образом:

```bash
# Запуск всех тестов
pytest

# Запуск тестов для модуля пользователя
pytest app/tests/test_user.py

# Запуск тестов с подробным выводом
pytest -v
```

### Потенциальные проблемы и их решение

1. **Ошибка при миграции с существующей базы данных**

   Если у вас уже есть данные в базе и вы получаете ошибки при запуске после обновления:

   ```bash
   # Удалите существующую базу SQLite (только для разработки!)
   rm psybalans.db

   # Запустите приложение заново - таблицы будут созданы с новой схемой
   uvicorn app.main:app --reload
   ```

2. **Проблемы с подключением к PostgreSQL**

   Если вы видите ошибки подключения к PostgreSQL:

   ```
   # Закомментируйте строку DATABASE_URL в .env файле
   # DATABASE_URL=postgresql+asyncpg://username:password@hostname:5432/dbname
   
   # Проект автоматически будет использовать SQLite
   ```

3. **Ошибки в MongoDB индексах**

   Если видите ошибки о конфликтах индексов MongoDB:

   ```python
   # Эти ошибки не критичны, они означают, что индексы уже существуют
   # Проект продолжит работу нормально
   
   # Для полного сброса индексов, можно запустить в MongoDB shell:
   # db.getCollectionNames().forEach(function(collection) {
   #   db[collection].dropIndexes();
   # });
   ```

4. **Проблемы с Redis**

   Если Redis недоступен:

   ```
   # Ничего делать не нужно, проект автоматически 
   # использует резервную in-memory реализацию Redis
   ```

5. **Проблемы с UUID**

   Если у вас возникают проблемы с UUID в SQLite:

   ```python
   # Проект уже настроен для работы с UUID в SQLite
   # В app/core/database/postgresql.py используется:
   engine = create_async_engine(
       "sqlite+aiosqlite:///./psybalans.db",
       connect_args={"check_same_thread": False}
   )
   ```

6. **Ошибки импорта модулей**

   Если вы получаете ошибки импорта:

   ```python
   # Замените все импорты из app.database на импорты из app.core.database
   # Было:  from app.database import get_db
   # Стало: from app.core.database import get_db
   ```

7. **Активация пользователя**

   По умолчанию, все новые пользователи активны (`is_active=True`). Если вы хотите изменить это поведение, отредактируйте метод `create_user` в файле `app/modules/user/service.py`.

## Архитектура бэкенда

PsyBalans использует микросервисно-модульную архитектуру с RESTful API и WebSocket для обеспечения реактивности взаимодействия в реальном времени.

### Ключевые технологии

- **Язык и фреймворк**: Python (FastAPI) для высокопроизводительного API
- **Базы данных**: 
  - PostgreSQL для структурированных данных (пользователи, активности)
  - MongoDB для полуструктурированных данных (дневники, записи)
  - Redis для кэширования и обмена сообщениями
- **Асинхронная обработка**: Celery для фоновых задач, планировщика и аналитики
- **Безопасность**: JWT (Access/Refresh токены), шифрование чувствительных данных

### Слоистая архитектура

- API-слой: обработка HTTP-запросов, валидация данных, маршрутизация
- Сервисный слой: бизнес-логика и координация между сервисами
- Репозиторный слой: абстракция доступа к данным
- Слой моделей: структуры данных и объектно-реляционное отображение

## Архитектура баз данных

PsyBalans использует полиглотную архитектуру хранения данных, комбинируя преимущества различных БД для оптимального хранения разных типов данных.

### PostgreSQL

Используется для хранения структурированных данных с жесткой схемой и отношениями.

#### Ключевые таблицы:
- **users**: Информация о пользователях (UUID идентификаторы, персональные данные)
- **activity_types**: Категории видов деятельности
- **activity_subtypes**: Подкатегории видов деятельности
- **activities**: Конкретные активности пользователей
- **need_categories**: Категории психологических потребностей
- **needs**: Конкретные потребности
- **user_needs**: Связь между пользователями и их потребностями
- **activity_need_link**: Связь между активностями и потребностями
- **user_calendars**: Календари пользователей
- **activity_schedules**: Запланированные активности

#### Особенности:
- Асинхронное взаимодействие через SQLAlchemy и asyncpg
- Каскадное удаление связанных данных
- Оптимизированные индексы для часто запрашиваемых полей
- Использование UUID вместо целочисленных ID для безопасности

### MongoDB

Используется для хранения полуструктурированных и изменяемых данных, таких как дневниковые записи.

#### Ключевые коллекции:
- **mood_entries**: Записи о настроении
- **thought_entries**: Записи о мыслях, включая когнитивные искажения
- **activity_evaluations**: Оценки выполненных активностей
- **state_snapshots**: Снимки общего состояния пользователя
- **recommendations**: Системные рекомендации
- **diary_entries**: Записи интегративного дневника

#### Особенности:
- Схемы валидации для поддержания согласованности данных
- Текстовые и составные индексы для эффективного поиска
- Асинхронный доступ через motor
- Агрегационные запросы для аналитики
- Отказоустойчивое подключение с резервным режимом в памяти

### Redis

Используется для кэширования, обмена сообщениями и хранения временных данных.

#### Основные применения:
- Кэширование часто запрашиваемых данных
- Хранение сессий пользователей
- Реализация паттерна pub/sub для обмена сообщениями
- Временные данные для аналитики

#### Особенности:
- Асинхронное взаимодействие через redis-py
- Механизм TTL для автоматического устаревания данных
- Резервный режим в памяти при недоступности Redis-сервера

### Интеграция и отказоустойчивость

- **Полиглотные репозитории**: Единый интерфейс для работы с разными БД
- **Circuit breaker**: Предотвращение каскадных сбоев при недоступности БД
- **Механизм повторов**: Автоматические повторные попытки при временных ошибках
- **Резервные режимы**: SQLite для PostgreSQL, in-memory имитация для MongoDB и Redis
- **Транзакционность**: Поддержка ACID-транзакций в PostgreSQL
- **Консистентность**: Журналирование операций для обеспечения согласованности

### Схема взаимодействия слоев с БД

```
API Routes -> Services -> Repositories <-> Database Adapters <-> Actual Databases
                                       \-> Fallback In-Memory Implementations
```

- **Database Adapters**: Абстракции для работы с конкретными БД (app/core/database/)
- **Repositories**: Реализация бизнес-логики доступа к данным (app/repositories/, app/mongodb/)
- **Services**: Координация доступа к данным и бизнес-логика (app/services/)
- **API Routes**: Маршруты для доступа к сервисам (app/modules/*/routes.py)

## План разработки бэкенда

### Этап 1: Основа системы (текущий этап)
- ✅ Настройка проекта и окружения разработки
- ✅ Создание базовой структуры проекта
- ✅ Настройка подключения к базам данных (SQLite для разработки)
- ✅ Реализация базовой модели пользователя
- ✅ Настройка аутентификации и JWT
- ✅ Базовые API эндпоинты для работы с пользователями
- ✅ Расширенная модель пользователя с поддержкой UUID и временных меток

### Этап 2: Базовые модули
- ✅ Реализация модуля активностей (модели, CRUD операции)
- ✅ Реализация модуля календаря/расписания
- ⬜ Настройка системы шаблонов активностей
- ✅ API для управления активностями
- ✅ Настройка MongoDB для хранения дневников

### Этап 3: Ядро системы
- ✅ Модуль дневников (настроения, активностей, мыслей)
- ✅ Модуль состояния (агрегация показателей, расчет трендов)
- ✅ Модуль потребностей (оценка удовлетворенности, динамика)
- ⬜ Добавление WebSocket для обновлений в реальном времени

### Этап 4: Аналитика и рекомендации
- ✅ Система рекомендаций (RecommendationEngine)
- ⬜ Реализация Celery для асинхронных задач и расчетов
- ⬜ Модуль аналитики и предиктивного анализа
- ⬜ Система уведомлений и напоминаний

### Этап 5: Интеграции и масштабирование
- ⬜ Интеграция с внешними API (календари, трекеры здоровья)
- ⬜ Настройка кэширования и оптимизация производительности
- ⬜ Интеграция с AI-моделями для анализа текста
- ⬜ Подготовка к масштабированию (шардинг, репликация)

## Текущая структура проекта

```
app/
  ├── core/ - ядро приложения
  │   ├── auth.py - аутентификация и авторизация
  │   ├── security.py - безопасность и JWT
  │   ├── database/ - модуль работы с базами данных
  │   │   ├── postgresql.py - взаимодействие с PostgreSQL
  │   │   ├── mongodb.py - взаимодействие с MongoDB
  │   │   ├── redis_client.py - взаимодействие с Redis
  │   │   ├── retry.py - механизм повторных попыток
  │   │   ├── mongodb_indexes.py - настройка индексов MongoDB
  │   │   └── startup.py - инициализация баз данных
  │   ├── logging/ - модуль логирования
  │   ├── middleware/ - HTTP и DB middleware
  │   └── resilience/ - отказоустойчивость и circuit breaker
  ├── main.py - основной файл приложения
  ├── models/ - основные модели данных (PostgreSQL)
  │   ├── user.py - модель пользователя
  │   ├── activity.py - модель активностей
  │   ├── needs.py - модель потребностей
  │   ├── calendar.py - модель календаря и расписания
  │   └── base.py - базовые классы моделей
  ├── mongodb/ - репозитории и схемы для MongoDB
  │   ├── mood_thought_repository.py - репозиторий дневников
  │   ├── activity_state_repository.py - репозиторий состояний
  │   ├── recommendations_diary_repository.py - репозиторий рекомендаций
  │   └── base_repository.py - базовый класс репозитория
  ├── repositories/ - репозитории для PostgreSQL
  │   ├── user_repository.py - репозиторий пользователей
  │   ├── activity_repository.py - репозиторий активностей
  │   └── need_repository.py - репозиторий потребностей
  ├── services/ - сервисный слой
  │   ├── activity_service.py - сервис управления активностями
  │   ├── need_service.py - сервис управления потребностями
  │   ├── recommendation_service.py - сервис рекомендаций
  │   └── state_service.py - сервис отслеживания состояния
  └── modules/ - модули API
      ├── auth/ - модуль аутентификации
      │   └── routes.py - API маршруты аутентификации
      ├── user/ - модуль пользователя
      │   ├── routes.py - API маршруты пользователя
      │   ├── schemas.py - схемы Pydantic
      │   └── service.py - бизнес-логика пользователя
      ├── diary/ - модуль дневников
      │   └── routes.py - API маршруты дневников
      ├── activity_state/ - модуль состояний и активностей
      │   └── routes.py - API маршруты состояний
      └── recommendations_diary/ - модуль рекомендаций
          └── routes.py - API маршруты рекомендаций
```

## Последние изменения (май 2024)

- **Улучшение модели пользователя:**
  - Переход на модель User с использованием UUID вместо целочисленных ID
  - Добавление полей first_name и last_name вместо единого full_name
  - Добавление полей is_active и is_superuser для контроля доступа
  - Добавление полей временных меток created_at и updated_at
  - Оптимизация для работы с PostgreSQL

- **Расширение API для управления пользователями:**
  - Добавлены административные эндпоинты для управления пользователями
  - Реализована логика активации/деактивации пользователей
  - Добавлена возможность удаления пользователей
  - Внедрена проверка ролей и прав доступа

- **Реализация модуля календаря/расписания:**
  - Создана модель UserCalendar для хранения календарей пользователя
  - Создана модель ActivitySchedule для планирования активностей
  - Реализована модель UserState для отслеживания состояния пользователя
  - Добавлена поддержка повторяющихся событий и синхронизации с внешними календарями
  - Расширены возможности для трекинга настроения, энергии и других показателей
  - Добавлена миграция для создания необходимых таблиц в базе данных
  
- **Оптимизация производительности базы данных:**
  - Созданы оптимальные B-tree индексы для часто запрашиваемых полей в PostgreSQL
  - Добавлены составные индексы для сложных запросов
  - Реализованы частичные индексы для оптимизации фильтрации по условиям
  - Внедрен полнотекстовый GIN-индекс для эффективного поиска по контенту
  - Добавлены индексы в MongoDB для оптимизации запросов к дневникам и состояниям 
  - Настроена автоматическая индексация коллекций при старте приложения

- **Реорганизация архитектуры баз данных:**
  - Перенос логики работы с БД в модульную структуру app/core/database/
  - Реализация полиглотного персистентного слоя с поддержкой PostgreSQL, MongoDB и Redis
  - Добавление механизмов отказоустойчивости при недоступности баз данных
  - Реализация in-memory мок-объектов для MongoDB и Redis
  - Настройка асинхронной работы с базами данных через современные драйверы
  - Реализация механизма повторных попыток с экспоненциальной задержкой
  - Внедрение оптимизированной системы логирования операций с БД
  - Улучшение обработки асинхронных операций с индексами MongoDB
  - Настройка реактивной системы разрешения зависимостей БД-сервисов

- **Улучшение сервисной архитектуры:**
  - Перенос основной модели User в app/models/user.py
  - Настройка обратной совместимости через импорты
  - Обновление схем Pydantic для работы с расширенной моделью пользователя
  - Улучшение сервисных функций для работы с UUID вместо целых чисел
  - Разделение ответственности между репозиториями и адаптерами баз данных
  - Внедрение паттерна Repository для всех моделей данных

## Проделанная работа

На текущий момент:
1. Создана базовая структура проекта с использованием FastAPI
2. Настроена конфигурация базы данных с поддержкой PostgreSQL и MongoDB
3. Добавлена временная поддержка SQLite для локальной разработки
4. Реализована расширенная модель пользователя с регистрацией
5. Созданы схемы Pydantic для валидации данных
6. Добавлены базовые маршруты API для работы с пользователями
7. Настроена тестовая среда для проверки API
8. Реализована JWT-аутентификация с access и refresh токенами
9. Добавлены защищенные маршруты для работы с пользовательским профилем
10. Настроена система безопасного хранения и проверки паролей
11. Реализован механизм получения текущего авторизованного пользователя
12. Реализована расширенная модель пользователя с использованием UUID, раздельных полей имени и фамилии, статуса активности и временных меток
13. Добавлены административные эндпоинты для управления пользователями с проверкой прав доступа
14. Реализована поддержка для активации/деактивации пользователей и полного удаления аккаунта
15. Созданы MongoDB схемы для хранения оценок активностей (activity_evaluations) и снимков состояния пользователя (state_snapshots)
16. Настроены индексы для оптимизации запросов по пользователю, времени и типам снимков
17. Реализованы CRUD-операции и аналитические функции для работы с активностями и состояниями
18. Добавлены API-эндпоинты для работы с оценками активностей и состояниями пользователя
19. Создана MongoDB схема для хранения записей в дневниках мыслей и настроения
20. Реализованы репозитории и API-эндпоинты для работы с дневниками
21. Созданы MongoDB схемы для хранения рекомендаций системы (recommendations) и записей интегративного дневника (diary_entries)
22. Реализованы репозитории с CRUD-операциями и аналитическими функциями для рекомендаций и интегративного дневника
23. Настроены индексы для эффективного поиска по пользователю, времени и другим критериям в новых коллекциях
24. Добавлены API-эндпоинты для работы с рекомендациями и интегративным дневником
25. Разработаны сервисные классы для работы с активностями (ActivityService) и потребностями (NeedService)
26. Реализована бизнес-логика для управления активностями и потребностями пользователя
27. Созданы репозитории для работы с моделями, соблюдая принцип разделения ответственности
28. Создана миграция для таблиц календаря и расписания (user_calendars, activity_schedules, user_states)
29. Реализованы модели для работы с календарями пользователя (UserCalendar)
30. Реализована модель для планирования активностей (ActivitySchedule)
31. Расширена модель состояния пользователя (UserState) с дополнительными показателями
32. Добавлена поддержка повторяющихся событий и синхронизации с внешними календарями
33. Созданы индексы для оптимизации производительности в PostgreSQL для основных таблиц системы
34. Добавлены специализированные B-tree индексы для часто запрашиваемых полей
35. Реализованы частичные индексы (partial indexes) для оптимизации специфичных запросов
36. Добавлен полнотекстовый GIN-индекс для поиска потребностей по описанию
37. Создана система индексов для MongoDB коллекций (записи настроения, мыслей, оценки активностей)
38. Реализованы текстовые индексы в MongoDB для полнотекстового поиска в записях дневников
39. Добавлены составные индексы для оптимизации сложных запросов в MongoDB
40. Настроена автоматическая индексация MongoDB при инициализации приложения

## API эндпоинты

### Аутентификация и пользователи:
- `POST /api/user/register` - регистрация нового пользователя
- `POST /api/auth/login` - авторизация пользователя (получение JWT токенов)
- `POST /api/auth/refresh-token` - обновление токена доступа через refresh токен
- `GET /api/user/me` - получение информации о текущем пользователе
- `PUT /api/user/me` - обновление информации о текущем пользователе

### Административные API для пользователей:
- `GET /api/user/admin/users` - получение списка всех пользователей (только для администраторов)
- `GET /api/user/admin/users/{user_id}` - получение информации о пользователе по ID (только для администраторов)
- `PUT /api/user/admin/users/{user_id}/activate` - активация пользователя (только для администраторов)
- `PUT /api/user/admin/users/{user_id}/deactivate` - деактивация пользователя (только для администраторов)
- `DELETE /api/user/admin/users/{user_id}` - удаление пользователя (только для администраторов)

### Активности:
- `GET /api/activity` - получение списка активностей
- `POST /api/activity` - создание новой активности
- `PUT /api/activity/{id}` - обновление активности
- `DELETE /api/activity/{id}` - удаление активности

### Состояние активностей:
- `POST /api/activity-state/evaluations` - создание оценки активности
- `GET /api/activity-state/evaluations` - получение списка оценок активностей
- `GET /api/activity-state/evaluations/{evaluation_id}` - получение оценки активности по ID
- `PUT /api/activity-state/evaluations/{evaluation_id}` - обновление оценки активности
- `DELETE /api/activity-state/evaluations/{evaluation_id}` - удаление оценки активности
- `GET /api/activity-state/evaluations/user/{user_id}` - получение оценок активностей пользователя
- `GET /api/activity-state/evaluations/activity/{activity_id}` - получение оценок конкретной активности
- `GET /api/activity-state/evaluations/stats` - получение статистики по оценкам активностей

### Снимки состояния пользователя:
- `POST /api/activity-state/snapshots` - создание снимка состояния пользователя
- `GET /api/activity-state/snapshots` - получение списка снимков состояния
- `GET /api/activity-state/snapshots/{snapshot_id}` - получение снимка состояния по ID
- `PUT /api/activity-state/snapshots/{snapshot_id}` - обновление снимка состояния
- `DELETE /api/activity-state/snapshots/{snapshot_id}` - удаление снимка состояния
- `GET /api/activity-state/snapshots/user/{user_id}` - получение снимков состояния пользователя
- `GET /api/activity-state/snapshots/type/{snapshot_type}` - получение снимков состояния по типу
- `GET /api/activity-state/snapshots/trends` - получение трендов состояния пользователя

### Дневники:
- `POST /api/diary/mood` - запись настроения
- `GET /api/diary/mood` - получение списка записей настроения
- `GET /api/diary/mood/{entry_id}` - получение записи настроения по ID
- `PUT /api/diary/mood/{entry_id}` - обновление записи настроения
- `DELETE /api/diary/mood/{entry_id}` - удаление записи настроения
- `POST /api/diary/thoughts` - запись мыслей
- `GET /api/diary/thoughts` - получение списка записей мыслей
- `GET /api/diary/thoughts/{entry_id}` - получение записи мыслей по ID
- `PUT /api/diary/thoughts/{entry_id}` - обновление записи мыслей
- `DELETE /api/diary/thoughts/{entry_id}` - удаление записи мыслей
- `GET /api/diary/{type}/history` - история записей

### Рекомендации:
- `POST /api/recommendations-diary/recommendations` - создание новой рекомендации
- `GET /api/recommendations-diary/recommendations/{recommendation_id}` - получение рекомендации по ID
- `PUT /api/recommendations-diary/recommendations/{recommendation_id}` - обновление рекомендации
- `DELETE /api/recommendations-diary/recommendations/{recommendation_id}` - удаление рекомендации
- `GET /api/recommendations-diary/recommendations/user/{user_id}` - получение рекомендаций пользователя
- `GET /api/recommendations-diary/recommendations/type/{recommendation_type}` - получение рекомендаций по типу
- `GET /api/recommendations-diary/recommendations/trigger/{trigger_type}` - получение рекомендаций по типу триггера
- `GET /api/recommendations-diary/recommendations/response/{status}` - получение рекомендаций по статусу ответа
- `GET /api/recommendations-diary/recommendations/stats` - получение статистики по рекомендациям

### Интегративный дневник:
- `POST /api/recommendations-diary/diary` - создание новой записи дневника
- `GET /api/recommendations-diary/diary/{entry_id}` - получение записи дневника по ID
- `PUT /api/recommendations-diary/diary/{entry_id}` - обновление записи дневника
- `DELETE /api/recommendations-diary/diary/{entry_id}` - удаление записи дневника
- `GET /api/recommendations-diary/diary/user/{user_id}` - получение записей дневника пользователя
- `GET /api/recommendations-diary/diary/session/{session_id}` - получение записей дневника по ID сессии
- `GET /api/recommendations-diary/diary/type/{entry_type}` - получение записей дневника по типу
- `GET /api/recommendations-diary/diary/mood-range` - получение записей дневника по диапазону настроения
- `GET /api/recommendations-diary/diary/linked/{entry_id}` - получение связанных записей дневника
- `POST /api/recommendations-diary/diary/{entry_id}/message` - добавление сообщения в диалог
- `PUT /api/recommendations-diary/diary/{entry_id}/extracted-data` - обновление извлеченных данных
- `POST /api/recommendations-diary/diary/{entry_id}/link` - добавление связанной записи
- `GET /api/recommendations-diary/diary/stats` - получение статистики по дневниковым записям

### Состояние и аналитика:
- `GET /api/state/day` - состояние за день
- `GET /api/state/week` - тренды за неделю
- `GET /api/needs` - текущее покрытие потребностей